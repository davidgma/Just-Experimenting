<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Just Experimenting</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="coin.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.10.3/sql-wasm.js"></script>
</head>
<body class="bg-gray-900 text-gray-100 font-sans">

  <!-- Navbar -->
  <nav class="sticky top-0 bg-gray-800/50 backdrop-blur-sm border-b border-gray-700 z-10">
    <div class="max-w-4xl mx-auto px-4 sm:px-8">
      <div class="flex items-center justify-center h-16">
        <div class="flex items-center space-x-8">
          <a href="#home" id="nav-home" class="nav-link text-gray-400 hover:text-white transition-colors duration-300 p-2 rounded-md">
            <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" />
            </svg>
          </a>
          <a href="#sql" id="nav-sql" class="nav-link text-gray-400 hover:text-white transition-colors duration-300 p-2 rounded-md">
            <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375" />
            </svg>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <main class="min-h-screen bg-gray-900 text-gray-100 flex flex-col items-center p-4 sm:p-8">
    <div class="w-full max-w-4xl mx-auto">

      <!-- Home Page Content -->
      <div id="home-page" class="page-content hidden">
        <div class="text-center flex flex-col items-center justify-center h-[60vh]">
            <svg class="w-32 h-32 text-purple-400 mb-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.182 15.182a4.5 4.5 0 0 1-6.364 0M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM9 9.75h.008v.008H9V9.75Zm6 0h.008v.008H15V9.75Z" />
            </svg>
            <h1 class="text-5xl font-bold text-gray-200">Hello World</h1>
        </div>
      </div>
      
      <!-- SQL Page Content -->
      <div id="sql-page" class="page-content hidden">
        <!-- Header -->
        <header class="text-center mb-8">
          <h1 class="text-4xl sm:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">
            Client-Side SQL
          </h1>
          <p class="text-gray-400 mt-2">Import and query a local SQLite database directly in your browser.</p>
        </header>
    
        <!-- DB Import Section -->
        <section class="mb-6">
          <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <label for="db-file-input" class="flex-1 relative flex justify-center items-center px-8 py-3 bg-gray-800 text-gray-300 font-semibold rounded-lg shadow-lg border-2 border-dashed border-gray-600 hover:border-pink-500 hover:text-white transition-all duration-300 cursor-pointer">
                <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" />
                </svg>
                Import SQLite Database
            </label>
            <input type="file" id="db-file-input" class="hidden" accept=".sqlite,.sqlite3,.db">
            
            <button id="use-default-db-button" class="flex-1 relative flex justify-center items-center px-8 py-3 bg-gray-800 text-gray-300 font-semibold rounded-lg shadow-lg border-2 border-dashed border-gray-600 hover:border-purple-500 hover:text-white transition-all duration-300 cursor-pointer disabled:cursor-wait disabled:opacity-75">
                <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375" />
                </svg>
                <span>Use Default Database</span>
            </button>

            <button id="export-db-button" class="flex-1 relative flex justify-center items-center px-8 py-3 bg-gray-800 text-gray-300 font-semibold rounded-lg shadow-lg border-2 border-dashed border-gray-600 hover:border-green-500 hover:text-white transition-all duration-300 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed" disabled>
              <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
              </svg>
              <span>Export Database</span>
            </button>
          </div>
          <p id="db-status" class="text-center text-gray-500 mt-4">No database loaded.</p>
        </section>
  
        <!-- SQL Query Section -->
        <section id="sql-section" class="mb-6 opacity-50 pointer-events-none">
          <div class="relative">
            <label for="prompt-input" class="block text-lg font-medium text-gray-300 mb-2">Enter your SQL Query</label>
            <textarea
              id="prompt-input"
              rows="4"
              class="w-full p-4 bg-gray-800 border-2 border-gray-700 rounded-lg shadow-md focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-all duration-300 resize-y text-gray-200 placeholder-gray-500 font-mono"
              placeholder="e.g., SELECT * FROM users;"
              disabled
            >SELECT * FROM albums LIMIT 10;
insert into albums select max(AlbumId) + 1, 'AI generated', 1 from albums;
select * from albums where title = 'AI generated';
SELECT name FROM sqlite_master WHERE type='table';
</textarea>
          </div>
          <div class="mt-4 flex justify-center">
            <button
              id="generate-button"
              class="relative inline-flex items-center justify-center px-8 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold rounded-lg shadow-lg hover:from-purple-600 hover:to-pink-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-pink-500"
              disabled
            >
              Execute Query
            </button>
          </div>
        </section>
    
        <!-- Response Output Section -->
        <section class="mt-8">
          <div id="error-container" class="bg-red-900 border border-red-700 text-red-200 px-4 py-3 rounded-lg relative hidden" role="alert">
            <strong class="font-bold">Error:</strong>
            <span id="error-text" class="block sm:inline ml-2 font-mono"></span>
          </div>
  
          <div id="response-container" class="bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-lg p-6 shadow-xl hidden">
            <h2 class="text-2xl font-semibold text-gray-200 mb-4">Query Results</h2>
            <div id="response-table" class="overflow-x-auto"></div>
          </div>
  
          <div id="placeholder-container" class="text-center text-gray-500 border-2 border-dashed border-gray-700 rounded-lg p-12">
              <p>Load a database and run a query to see results here.</p>
          </div>
        </section>
      </div>
  
    </div>
  </main>
  <script type="module">
    // --- Router and Page Elements ---
    const pages = document.querySelectorAll('.page-content');
    const navLinks = document.querySelectorAll('.nav-link');
    const homePage = document.getElementById('home-page');
    const sqlPage = document.getElementById('sql-page');

    // --- SQL Page DOM Element References ---
    const dbFileInput = document.getElementById('db-file-input');
    const useDefaultDbButton = document.getElementById('use-default-db-button');
    const exportDbButton = document.getElementById('export-db-button');
    const dbStatus = document.getElementById('db-status');
    const sqlSection = document.getElementById('sql-section');
    const promptInput = document.getElementById('prompt-input');
    const generateButton = document.getElementById('generate-button');
    const responseContainer = document.getElementById('response-container');
    const responseTable = document.getElementById('response-table');
    const placeholderContainer = document.getElementById('placeholder-container');
    const errorContainer = document.getElementById('error-container');
    const errorText = document.getElementById('error-text');

    let db = null;
    let SQL = null;
    let dbFilename = 'default.db';
    
    // --- Routing Logic ---
    function router() {
      const hash = window.location.hash || '#home';
      
      pages.forEach(page => page.classList.add('hidden'));

      if (hash === '#sql') {
        sqlPage.classList.remove('hidden');
      } else {
        homePage.classList.remove('hidden');
      }
      
      updateNavActiveState(hash);
    }

    function updateNavActiveState(activeHash) {
      navLinks.forEach(link => {
        if (link.getAttribute('href') === activeHash) {
          link.classList.add('text-pink-500');
          link.classList.remove('text-gray-400');
        } else {
          link.classList.remove('text-pink-500');
          link.classList.add('text-gray-400');
        }
      });
    }

    // --- SQL Page Core Logic ---
    async function initSql() {
      try {
        SQL = await initSqlJs({
          locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.10.3/${file}`
        });
      } catch (e) {
        console.error(e);
        displayError("Failed to load SQL.js library. Check your network connection.");
      }
    }

    function loadDatabase(file) {
      const reader = new FileReader();
      reader.onload = function() {
        try {
          const Uints = new Uint8Array(reader.result);
          db = new SQL.Database(Uints);
          dbFilename = file.name;
          dbStatus.textContent = `Database loaded: ${file.name}`;
          dbStatus.classList.remove('text-gray-500', 'text-red-400');
          dbStatus.classList.add('text-green-400');
          enableQuerying();
          hideError();
        } catch (e) {
          console.error(e);
          displayError(`Failed to load database. Is it a valid SQLite file? Error: ${e.message}`);
          dbStatus.textContent = `Failed to load ${file.name}`;
          dbStatus.classList.remove('text-green-400');
          dbStatus.classList.add('text-red-400');
          disableQuerying();
        }
      }
      reader.onerror = function() {
        displayError("Error reading the selected file.");
      }
      reader.readAsArrayBuffer(file);
    }

    async function createDefaultDatabase() {
        if (!SQL) {
            displayError("SQL library not yet initialized. Please wait a moment and try again.");
            return;
        }

        const originalButtonContent = useDefaultDbButton.innerHTML;
        useDefaultDbButton.disabled = true;
        useDefaultDbButton.innerHTML = `
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>Loading...</span>
        `;
        dbStatus.textContent = 'Downloading and creating default database...';
        dbStatus.classList.remove('text-red-400', 'text-green-400');
        dbStatus.classList.add('text-gray-500');

        try {
            const sqlFileUrl = 'default-data.txt';
            const response = await fetch(sqlFileUrl);

            if (!response.ok) {
                throw new Error(`Failed to fetch SQL file: ${response.status} ${response.statusText}`);
            }

            const schemaAndDataCommands = await response.text();
            
            db = new SQL.Database();
            db.run(schemaAndDataCommands);

            dbFilename = 'default.db';
            dbStatus.textContent = "Default database created and populated.";
            dbStatus.classList.remove('text-gray-500', 'text-red-400');
            dbStatus.classList.add('text-green-400');
            dbFileInput.value = ''; // Clear file input in case a file was selected
            enableQuerying();
            hideError();
        } catch (e) {
            console.error(e);
            displayError(`Failed to create default database. Error: ${e.message}`);
            dbStatus.textContent = 'Failed to create default database.';
            dbStatus.classList.remove('text-green-400');
            dbStatus.classList.add('text-red-400');
            disableQuerying();
        } finally {
            useDefaultDbButton.disabled = false;
            useDefaultDbButton.innerHTML = originalButtonContent;
        }
    }

    function executeQuery() {
        const query = promptInput.value.trim();
        if (!db || !query) return;

        hideError();
        placeholderContainer.classList.add('hidden');
        responseContainer.classList.add('hidden');

        try {
            const results = db.exec(query);
            displayResults(results);
        } catch (e) {
            console.error(e);
            displayError(e.message);
        }
    }

    function exportDatabase() {
        if (!db) {
            displayError("No database is currently loaded to export.");
            return;
        }

        try {
            const data = db.export();
            const blob = new Blob([data], { type: "application/x-sqlite3" });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement("a");
            document.body.appendChild(a);
            a.href = url;
            a.download = dbFilename || 'database.db';
            a.click();
            
            setTimeout(() => {
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            }, 0);
        } catch (e) {
            console.error(e);
            displayError(`Failed to export database. Error: ${e.message}`);
        }
    }

    // --- SQL Page UI Update Functions ---
    function enableQuerying() {
      sqlSection.classList.remove('opacity-50', 'pointer-events-none');
      promptInput.disabled = false;
      generateButton.disabled = false;
      exportDbButton.disabled = false;
    }

    function disableQuerying() {
      sqlSection.classList.add('opacity-50', 'pointer-events-none');
      promptInput.disabled = true;
      generateButton.disabled = true;
      exportDbButton.disabled = true;
    }

    function displayError(message) {
      errorContainer.classList.remove('hidden');
      errorText.textContent = message;
      responseContainer.classList.add('hidden');
    }

    function hideError() {
      errorContainer.classList.add('hidden');
    }

    function displayResults(results) {
        responseTable.innerHTML = ''; // Clear previous results

        if (results.length === 0) {
            responseTable.innerHTML = `<p class="text-gray-400">Query executed successfully. No rows returned.</p>`;
            responseContainer.classList.remove('hidden');
            return;
        }

        results.forEach((result, index) => {
            const table = document.createElement('table');
            table.className = 'min-w-full divide-y divide-gray-700 mb-6';

            const thead = document.createElement('thead');
            thead.className = 'bg-gray-800';
            const headerRow = document.createElement('tr');
            result.columns.forEach(colName => {
                const th = document.createElement('th');
                th.scope = 'col';
                th.className = 'px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider';
                th.textContent = colName;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');
            tbody.className = 'bg-gray-900 divide-y divide-gray-700';
            result.values.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-800/50';
                row.forEach(cellValue => {
                    const td = document.createElement('td');
                    td.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-400';
                    td.textContent = cellValue;
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
            responseTable.appendChild(table);
        });

        responseContainer.classList.remove('hidden');
    }

    // --- Event Handlers ---
    dbFileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        loadDatabase(file);
      }
    });
    
    generateButton.addEventListener('click', executeQuery);
    
    useDefaultDbButton.addEventListener('click', createDefaultDatabase);

    exportDbButton.addEventListener('click', exportDatabase);

    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetHash = link.getAttribute('href');
        if (window.location.hash !== targetHash) {
          history.pushState(null, '', targetHash);
          router();
        }
      });
    });

    // --- App Initialization ---
    // Handle back/forward browser buttons
    window.addEventListener('popstate', router);
    
    // Handle initial page load
    document.addEventListener('DOMContentLoaded', () => {
        router();
        initSql();
    });
  </script>
</body>
</html>